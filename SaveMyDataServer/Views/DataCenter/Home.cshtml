@model SaveMyDataServer.ViewModels.DataCenter.DataCenterHomeViewModel;
@{

    ViewData["Title"] = "Data Center";
}
<div class="jumbotron mt-5">
    <h1 class="display-4">Welcome to your database panel,</h1>
    <p class="lead">You can see what are the table that you created and ther data inside of each table also export the data into diffrenet formats!</p>
    <hr class="my-4" />
    <p class="font-weight-bold">Current databae: <span class="text-info font-weight-light" id="selected-database-name">@Model.Database</span></p>
    <p class="font-weight-bold">
        Tables <span class="badge badge-info align-middle">@Model.TablesAndCount.Count</span> :

        @foreach (var item in Model.TablesAndCount)
        {
            <span class="text-info font-weight-light">@item.Key<span class="badge badge-dark align-middle m-1" id="@item.Key-count">@item.Value</span> , </span>
        }
    </p>
    <form class="text-center">
        <label for="dbTable" class="font-weight-bold">Select Table</label>
        <div class=" grid">
            <div class="row">
                <select class="form-control col-10" id="dbTable" onchange="initializeTable()">
                    @{
                        foreach (var item in Model.TablesAndCount)
                        {
                            <option value="@item.Key">@item.Key </option>
                        }
                    }
                </select>
                <button class="btn btn-outline-info col-1 ml-2" type="button" onclick="shoEditTableModal()">Edit</button>

            </div>
        </div>
    </form>

    <div class="container justify-content-left m-2">
        <span><b>Export to: </b></span>
        <i class="far fa-file-excel excel-icon" aria-label="excel" onclick="exportData(this,'@SaveMyDataServer.SharedKernal.Enums.SupportedExportFileTypes.Excel')">
            <span class="sr-only">Export to excel</span>
        </i>
    </div>
</div>

<div class="container-fluid text-center">
    <h1 class="display-6 font-weight-bold d-inline-block">Table: <span class="text-info font-weight-light" id="selected-table-title"></span></h1> <button onclick="showEditModal(this,true)" class="btn btn-outline-success mb-3 ml-2">+</button>
    <div id="selected-table-content" class="text-left  table-responsive border">

    </div>
    <nav aria-label="page pagination" class="m-3" id="pagination-part">

    </nav>
</div>


<div class="modal fade" id="edit-record-modal">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <input hidden id="record-id" />
            <input hidden id="record-table-name" />
            <input hidden id="record-database-name" />
            <div class="modal-header">
                <h5 class="modal-title">Record panel </h5>
                <button class="close" aria-label="close" data-dismiss="modal">
                    <span class="text-info">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <button class="btn btn-outline-info mb-4" onclick="addNewFieldValueEmptyRow()">add</button>
                <div class="grid" id="edit-record-modal-body-grid">

                </div>
            </div>
            <div class="modal-footer" id="edit-modal-footer">
                <button class="btn btn-secondary" data-dismiss="modal">Close</button>
                <div id="edit-mode-buttons">
                    <button class="btn btn-danger" onclick="askConfirmation()">Delete</button>
                    <button class="btn btn-info" id="edit-modal-btn" onclick="editRecord(this)">Edit</button>
                </div>
                <div id="add-mode-buttons">
                    <button class="btn btn-success" onclick="addRecord(this)">Add</button>
                </div>
            </div>
        </div>
    </div>
</div>

@Html.Partial("_ConfirmationModals")

<div class="modal fade" id="edit-table-modal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Edit table</h5>
            </div>
            <div class="modal-body">
                <div class="input-group mb-3">
                    <div class="input-group-prepend">
                        <span class="input-group-text">Name</span>
                    </div>
                    <input type="text" class="form-control selected-table-name-holder" disabled />
                </div>
                <div class="input-group mb-3">
                    <div class="input-group-prepend">
                        <span class="input-group-text">New name</span>
                    </div>
                    <input type="text" class="form-control" id="table-new-name" />
                </div>

            </div>
            <div class="modal-footer" id="edit-modal-footer">
                <button class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button class="btn btn-info" onclick='editTable(this)'>Edit</button>
                <button class="btn btn-danger" onclick="showDeleteTableConfirmation()" id="delete-modal-btn">Delete</button>
            </div>
        </div>
    </div>
</div>

<div class="modal bg-dark fade" id="delete-table-confirmation-modal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Please confirme the delete operation</h5>
            </div>
            <div class="modal-body">
                <div class="input-group mb-3">
                    <div class="input-group-prepend">
                        <span class="input-group-text">Name</span>
                    </div>
                    <input type="text" class="form-control selected-table-name-holder" disabled />
                </div>
            </div>
            <div class="modal-footer" id="edit-modal-footer">
                <button class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button class="btn btn-danger" onclick="deleteTable(this)" id="delete-modal-btn">Delete</button>
            </div>
        </div>
    </div>
</div>

<script src="~/js/Custom/spinners.js" type="text/javascript"></script>
<script src="~/js/Custom/dataCenterHome.js" type="text/javascript"></script>
<script src="~/js/Custom/pagination.js" type="text/javascript"></script>

<script>
    //cross values
    //The count of records to get in each request
    var recordsCountInTable = @SaveMyDataServer.Static.ServerPaginationCount.LargePage;
    var workingDatabase = '@Model.Database';

    //Once the documnet is loaded
    $(function () {
        initializeTable();
    })
    //
    //Requests to export the data into the wanted type
    // type: the type to export the data for
    //
    function exportData(element, type) {
        location.href = '@SaveMyDataServer.Static.ServerAjaxURLs.ExportData'+'?table=' + document.getElementById('selected-table-title').innerText +'&database=' + workingDatabase +'&type='+ type;
        return false;
    }
    //
    //Exports a single record into a the wanted file type
    // id : the id of the record to export
    // type : the type of file we want to export to
    //
    function exportRecord(id, type) {
        location.href = '@SaveMyDataServer.Static.ServerAjaxURLs.ExportRecord'+'?id=' + id + '&table=' + document.getElementById('selected-table-title').innerText +'&database=' + workingDatabase +'&type='+ type;
        return false;

    }


</script>

